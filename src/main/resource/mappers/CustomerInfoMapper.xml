<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd" >
<mapper namespace="com.yulan.dao.CustomerInfoDao">
    <resultMap id="CustomerInfoMap" type="CustomerInfoCard" >
        <result column="CID" property="cID" />
    </resultMap>
    <resultMap id="CustomerInfoCardMap" type="com.yulan.pojo.CustomerInfoCard" >
        <result column="GROUPID" property="groupid" jdbcType="VARCHAR" />
        <result column="DELETED" property="deleted" jdbcType="DECIMAL" />
        <result column="ERPCOPYED" property="erpcopyed" jdbcType="DECIMAL" />
        <result column="CONTRACTYEAR" property="contractyear" jdbcType="DECIMAL" />
        <result column="CID" property="cid" jdbcType="VARCHAR" />
        <result column="CNAME" property="cname" jdbcType="VARCHAR" />
        <result column="MARKET" property="market" jdbcType="VARCHAR" />
        <result column="MARKETNAME" property="marketname" jdbcType="VARCHAR" />
        <result column="SUBMARKET" property="submarket" jdbcType="VARCHAR" />
        <result column="SUBMARKETNAME" property="submarketname" jdbcType="VARCHAR" />
        <result column="MARKETMANAGER" property="marketmanager" jdbcType="VARCHAR" />
        <result column="MARKETMANAGERNAME" property="marketmanagername" jdbcType="VARCHAR" />
        <result column="SUBMARKETMANAGER" property="submarketmanager" jdbcType="VARCHAR" />
        <result column="SUBMARKETMANAGERNAME" property="submarketmanagername" jdbcType="VARCHAR" />
        <result column="MANAGERPOSITION" property="managerposition" jdbcType="VARCHAR" />
        <result column="X_DISTRICT" property="xDistrict" jdbcType="VARCHAR" />
        <result column="X_AREA_DISTRICT_2" property="xAreaDistrict2" jdbcType="VARCHAR" />
        <result column="X_AREA_DISTRICT_3" property="xAreaDistrict3" jdbcType="VARCHAR" />
        <result column="DISTRICT_TEXT" property="districtText" jdbcType="VARCHAR" />
        <result column="AREA_DISTRICT_2_TEXT" property="areaDistrict2Text" jdbcType="VARCHAR" />
        <result column="AREA_DISTRICT_3_TEXT" property="areaDistrict3Text" jdbcType="VARCHAR" />
        <result column="X_JURIDIC_PERSON" property="xJuridicPerson" jdbcType="VARCHAR" />
        <result column="JURIDIC_PERSON_HANDSET" property="juridicPersonHandset" jdbcType="VARCHAR" />
        <result column="X_OFFICE_TEL" property="xOfficeTel" jdbcType="VARCHAR" />
        <result column="X_HANDSET" property="xHandset" jdbcType="VARCHAR" />
        <result column="X_EMAIL" property="xEmail" jdbcType="VARCHAR" />
        <result column="X_FAX" property="xFax" jdbcType="VARCHAR" />
        <result column="QQ" property="qq" jdbcType="VARCHAR" />
        <result column="X_POST_ADDRESS" property="xPostAddress" jdbcType="VARCHAR" />
        <result column="X_ZIP_CODE" property="xZipCode" jdbcType="VARCHAR" />
        <result column="X_OFFICE_TEL_1" property="xOfficeTel1" jdbcType="VARCHAR" />
        <result column="X_HANDSET_2" property="xHandset2" jdbcType="VARCHAR" />
        <result column="X_DELIVERY_ADRESS" property="xDeliveryAdress" jdbcType="VARCHAR" />
        <result column="FAX_WL" property="faxWl" jdbcType="VARCHAR" />
        <result column="ZIP_CODE_WL" property="zipCodeWl" jdbcType="VARCHAR" />
        <result column="TX_AGENT_NAME" property="txAgentName" jdbcType="VARCHAR" />
        <result column="WL_AGENT_NAME" property="wlAgentName" jdbcType="VARCHAR" />
        <result column="PREFEREDBRAND" property="preferedbrand" jdbcType="VARCHAR" />
        <result column="CURRENT_PRODUCT" property="currentProduct" jdbcType="VARCHAR" />
        <result column="SHOP_AREA" property="shopArea" jdbcType="DECIMAL" />
        <result column="INVOICE_TYPE" property="invoiceType" jdbcType="VARCHAR" />
        <result column="IS_GENERALTAXPAYER" property="isGeneraltaxpayer" jdbcType="VARCHAR" />
        <result column="ACCOUNT1_NAME" property="account1Name" jdbcType="VARCHAR" />
        <result column="ACCOUNT1_BANK" property="account1Bank" jdbcType="VARCHAR" />
        <result column="ACCOUNT1" property="account1" jdbcType="VARCHAR" />
        <result column="ACCOUNT2_NAME" property="account2Name" jdbcType="VARCHAR" />
        <result column="ACCOUNT2_BANK" property="account2Bank" jdbcType="VARCHAR" />
        <result column="ACCOUNT2" property="account2" jdbcType="VARCHAR" />
        <result column="ACCOUNT3_NAME" property="account3Name" jdbcType="VARCHAR" />
        <result column="ACCOUNT3_BANK" property="account3Bank" jdbcType="VARCHAR" />
        <result column="ACCOUNT3" property="account3" jdbcType="VARCHAR" />
        <result column="FILE_1_IDCARD" property="file1Idcard" jdbcType="VARCHAR" />
        <result column="FILE_1_OP" property="file1Op" jdbcType="VARCHAR" />
        <result column="FILE_2_BUSINESSLICENSE" property="file2Businesslicense" jdbcType="VARCHAR" />
        <result column="FILE_2_OP" property="file2Op" jdbcType="VARCHAR" />
        <result column="FILE_3_ORGCODE" property="file3Orgcode" jdbcType="VARCHAR" />
        <result column="FILE_3_OP" property="file3Op" jdbcType="VARCHAR" />
        <result column="FILE_4_GTQC" property="file4Gtqc" jdbcType="VARCHAR" />
        <result column="FILE_4_OP" property="file4Op" jdbcType="VARCHAR" />
        <result column="STATE" property="state" jdbcType="VARCHAR" />
        <result column="MEMO" property="memo" jdbcType="VARCHAR" />
        <result column="FILE_5_IDCARD_BG" property="file5IdcardBg" jdbcType="VARCHAR" />
        <result column="FILE_5_OP" property="file5Op" jdbcType="VARCHAR" />
        <result column="BUSIENT_TYPE" property="busientType" jdbcType="VARCHAR" />
        <result column="ACCOUNT1_LOCATION" property="account1Location" jdbcType="VARCHAR" />
        <result column="ACCOUNT2_LOCATION" property="account2Location" jdbcType="VARCHAR" />
        <result column="FILE_1_IDCARD_NO" property="file1IdcardNo" jdbcType="VARCHAR" />
        <result column="FILE_2_BUSINESSLICENSE_NO" property="file2BusinesslicenseNo" jdbcType="VARCHAR" />
        <result column="FILE_2_BUSINESSLICENSE_END" property="file2BusinesslicenseEnd" jdbcType="VARCHAR" />
        <result column="FILE_3_ORGCODE_NO" property="file3OrgcodeNo" jdbcType="VARCHAR" />
        <result column="FILE_4_GTQC_NO" property="file4GtqcNo" jdbcType="VARCHAR" />
        <result column="ACCOUNT1_MEMO" property="account1Memo" jdbcType="VARCHAR" />
        <result column="ACCOUNT2_MEMO" property="account2Memo" jdbcType="VARCHAR" />
        <result column="FLAG" property="flag" jdbcType="VARCHAR" />
        <result column="FILE_2_BUSINESSLICENSE_NOEND" property="file2BusinesslicenseNoend" jdbcType="DECIMAL" />
        <result column="HAS_PUBLIC_ACCOUNT" property="hasPublicAccount" jdbcType="VARCHAR" />
        <result column="UPDATE_FLAG" property="updateFlag" jdbcType="VARCHAR" />
        <result column="SYS_2017_STATE_CHANGE_OLD" property="sys2017StateChangeOld" jdbcType="VARCHAR" />
        <result column="SYS_2017_STATE_CHANGE_LOG" property="sys2017StateChangeLog" jdbcType="VARCHAR" />
        <result column="SYS_2017_STATE_CHANGE_TS" property="sys2017StateChangeTs" jdbcType="TIMESTAMP" />
        <result column="INV_ADDRESS" property="invAddress" jdbcType="VARCHAR" />
        <result column="INV_TELEPHONE" property="invTelephone" jdbcType="VARCHAR" />
        <result column="INV_BANKNAME" property="invBankname" jdbcType="VARCHAR" />
        <result column="INV_BANMACCOUNT" property="invBanmaccount" jdbcType="VARCHAR" />
        <result column="INV_REQUIREMENT" property="invRequirement" jdbcType="VARCHAR" />
        <result column="INV_REQUIREMENT_TS" property="invRequirementTs" jdbcType="TIMESTAMP" />
        <result column="INV_REQUIREMENT_LIST" property="invRequirementList" jdbcType="VARCHAR" />
        <result column="INV_NOTNEED_TS" property="invNotneedTs" jdbcType="TIMESTAMP" />
        <result column="INV_NOTNEED_IP" property="invNotneedIp" jdbcType="VARCHAR" />
        <result column="CUSTOMERENTITYTYPEX" property="customerentitytypex" jdbcType="CHAR" />
        <result column="LEGALCHECKED" property="legalchecked" jdbcType="DECIMAL" />
        <result column="CNAME_NEW" property="cnameNew" jdbcType="VARCHAR" />
        <result column="RECIPE_TARGET_MB" property="recipeTargetMb" jdbcType="VARCHAR" />
    </resultMap>
    <resultMap id="YLcontractMap" type="com.yulan.pojo.YLcontract_v2015_paa" >
        <result column="CCYEAR" property="ccyear" jdbcType="DECIMAL" />
        <result column="CCID" property="ccid" jdbcType="VARCHAR" />
        <result column="NAME" property="name" jdbcType="VARCHAR" />
        <result column="ACCOUNT_BANK" property="accountBank" jdbcType="VARCHAR" />
        <result column="ACCOUT" property="accout" jdbcType="VARCHAR" />
        <result column="ACCOUNT_LOCATION" property="accountLocation" jdbcType="VARCHAR" />
        <result column="AUTHFILE_IAMGE" property="authfileIamge" jdbcType="VARCHAR" />
        <result column="IDCARD_IAMGE1" property="idcardIamge1" jdbcType="VARCHAR" />
        <result column="IDCARD_IAMGE2" property="idcardIamge2" jdbcType="VARCHAR" />
        <result column="IDCARD_NO" property="idcardNo" jdbcType="VARCHAR" />
    </resultMap>

    <select id="getAllinfo" resultMap="CustomerInfoCardMap">
        select * from(
        select rownum rm, c.*  from CUSTOMERINFOCARD c where 1=1

        <if test="year!=null">
            and c.contractyear = #{year}
        </if>
        <if test="state!=null">
            and c.state=#{state}
        </if>
        <if test="find!=null">
            and c.cid like  '%'||#{find}||'%' or c.cname like '%'||#{find}||'%'
        </if>

        ) tm where rm &gt;= #{start} and rm &lt;= #{number }

    </select>

    <select id="getInfobyStateandmarketName" resultType="HashMap">
        select
        *
        from(
        select rownum rm, a.*from(select  count(*) nums ,state, marketName,SUBMARKETMANAGERNAME
        from CUSTOMERINFOCARD c where 1=1
        <if test="year!=null">
            and c.contractyear=#{year}
        </if>
         group by state , marketName,SUBMARKETMANAGERNAME) a
        ) tm where rm &gt;= #{start} and rm &lt;= #{number }

    </select>

    <select id="getInfoBySate" resultType="HashMap" parameterType="String">
        select count(*) nums ,state from CUSTOMERINFOCARD c where 1=1
        <if test="year!=null">
           and c.contractyear=#{year}
        </if>
        group by state
    </select>

    <select id="count" resultType="int" parameterType="String">
        select count (*) from (select * from CUSTOMERINFOCARD c where 1=1
        <if test="year!=null">
            and c.contractyear=#{year}
        </if>
        group by state , marketName,SUBMARKETMANAGERNAME)
    </select>

    <select id="getAllStates" resultType="Map">
        select state from CUSTOMERINFOCARD group by state
    </select>

    <select id="countInfo" resultType="int">
        select count(*) from CUSTOMERINFOCARD c where 1=1
        <if test="year!=null">
            and c.contractyear = #{year}
        </if>
        <if test="state!=null">
            and c.state=#{state}
        </if>
        <if test="find!=null">
            and c.cid like  '%'||#{find}||'%' or c.cname like '%'||#{find}||'%'
        </if>

    </select>

    <select id="getCustomerInfo" parameterType="java.util.Map" resultType="CustomerInfoCard">
        select * from ( select * from CUSTOMERINFOCARD t where t.cid=#{CID} ORDER BY t.contractyear desc )WHERE ROWNUM =1
    </select>

    <select id="getYLcontract" parameterType="java.util.Map" resultType="YLcontract_v2015_paa">
        select * from ( select * from YLCONTRACT_V2015_PAA t where t.ccid=#{CCID} ORDER BY t.ccyear desc )WHERE ROWNUM =1
    </select>

    <update id="updateCustomerInfo" parameterType="CustomerInfoCard">
        update CUSTOMERINFOCARD
        set
        PREFEREDBRAND = #{preferedbrand,jdbcType=VARCHAR},
        CURRENT_PRODUCT = #{currentProduct,jdbcType=VARCHAR},
        INVOICE_TYPE = #{invoiceType,jdbcType=VARCHAR},
        SHOP_AREA = #{shopArea},
        JURIDIC_PERSON_HANDSET = #{juridicPersonHandset,jdbcType=VARCHAR},
        RECIPE_TARGET_MB = #{recipeTargetMb,jdbcType=VARCHAR},
        INV_ADDRESS = #{invAddress,jdbcType=VARCHAR},
        INV_TELEPHONE = #{invTelephone,jdbcType=VARCHAR},
        INV_BANKNAME = #{invBankname,jdbcType=VARCHAR},
        INV_BANMACCOUNT = #{invBanmaccount,jdbcType=VARCHAR},
        QQ = #{qq,jdbcType=VARCHAR},
        X_FAX = #{xFax,jdbcType=VARCHAR},
        X_EMAIL = #{xEmail,jdbcType=VARCHAR},
        X_ZIP_CODE = #{xZipCode,jdbcType=VARCHAR},
        FAX_WL = #{faxWl,jdbcType=VARCHAR},
        ZIP_CODE_WL = #{zipCodeWl,jdbcType=VARCHAR},
        HAS_PUBLIC_ACCOUNT = #{hasPublicAccount,jdbcType=VARCHAR},
        ACCOUNT1_BANK = #{account1Bank,jdbcType=VARCHAR},
        ACCOUNT1 = #{account1,jdbcType=VARCHAR},
        ACCOUNT1_LOCATION = #{account1Location,jdbcType=VARCHAR},
        ACCOUNT2_BANK = #{account2Bank,jdbcType=VARCHAR},
        ACCOUNT2 = #{account2,jdbcType=VARCHAR},
        ACCOUNT2_LOCATION = #{account2Location,jdbcType=VARCHAR},
        CUSTOMERENTITYTYPEX = #{customerentitytypex,jdbcType=CHAR},
        FILE_1_IDCARD = #{file1Idcard,jdbcType=VARCHAR},
        FILE_1_OP = #{file1Op,jdbcType=VARCHAR},
        FILE_2_BUSINESSLICENSE = #{file2Businesslicense,jdbcType=VARCHAR},
        FILE_2_OP = #{file2Op,jdbcType=VARCHAR},
        FILE_4_GTQC = #{file4Gtqc,jdbcType=VARCHAR},
        FILE_4_OP = #{file4Op,jdbcType=VARCHAR},
        FILE_5_IDCARD_BG = #{file5IdcardBg,jdbcType=VARCHAR},
        FILE_5_OP = #{file5Op,jdbcType=VARCHAR}
        where CID = #{cid} AND CONTRACTYEAR = (select CONTRACTYEAR from ( select * from CUSTOMERINFOCARD t where t.cid=#{cid} ORDER BY t.contractyear desc )WHERE ROWNUM =1)
  </update>

    <insert id="insertYLcontract" parameterType="YLcontract_v2015_paa">
      insert into YLCONTRACT_V2015_PAA (CCYEAR, CCID, NAME,
      ACCOUNT_BANK, ACCOUT, ACCOUNT_LOCATION,IDCARD_NO,AUTHFILE_IAMGE,IDCARD_IAMGE1,IDCARD_IAMGE2)
     values (
     #{ccyear,jdbcType=DECIMAL},
     #{ccid,jdbcType=VARCHAR},
     #{name,jdbcType=VARCHAR},
     #{accountBank,jdbcType=VARCHAR},
     #{accout,jdbcType=VARCHAR},
     #{accountLocation,jdbcType=VARCHAR},
     #{idcardNo,jdbcType=VARCHAR},
     #{authfileIamge,jdbcType=VARCHAR},
     #{idcardIamge1,jdbcType=VARCHAR},
     #{idcardIamge2,jdbcType=VARCHAR}
    )
  </insert>

    <update id="updateYLcontractImg" parameterType="java.util.Map">
        update YLCONTRACT_V2015_PAA
        set
        AUTHFILE_IAMGE = #{authfileIamge,jdbcType=VARCHAR},
        IDCARD_IAMGE1 = #{idcardIamge1,jdbcType=VARCHAR},
        IDCARD_IAMGE2 = #{idcardIamge2,jdbcType=VARCHAR}
        where CCID = #{ccid}
      </update>

    <update id="updateCustomerImg" parameterType="java.util.Map" >
        update CUSTOMERINFOCARD
        set
        FILE_1_IDCARD = #{file1Idcard,jdbcType=VARCHAR},
        FILE_1_OP = #{file1Op,jdbcType=VARCHAR},
        FILE_2_BUSINESSLICENSE = #{file2Businesslicense,jdbcType=VARCHAR},
        FILE_2_OP = #{file2Op,jdbcType=VARCHAR},
        FILE_4_GTQC = #{file4Gtqc,jdbcType=VARCHAR},
        FILE_4_OP = #{file4Op,jdbcType=VARCHAR},
        FILE_5_IDCARD_BG = #{file5IdcardBg,jdbcType=VARCHAR},
        FILE_5_OP = #{file5Op,jdbcType=VARCHAR},
        where CID = #{cid,jdbcType=VARCHAR}
  </update>

    <select id="getXAreaDistrictName" parameterType="java.util.Map" resultType="string">
        select REGION_NAME from AREA_REGION WHERE REGION_ID =#{REGION_ID}
    </select>

    <select id="getXDistrict" parameterType="java.util.Map" resultType="string">
        select DISTRICT_NAME from AREA_DISTRICT WHERE DISTRICT_ID =#{DISTRICT_ID}
    </select>

</mapper>
